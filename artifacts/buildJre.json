[
  { "cmd": ["mkdir", "-f", "build"] },
  { "cmd": ["cp", "-av", ":x
[ -d build ] || mkdir build
cp -av ~/hsqldb/lib/hsqldbmin.jar ~/hsqldb/lib/sqltool.jar build ||
Abort 'Failed to copy in hsqldb jars'

# Test modular jars
java -p build/sqltool.jar -m org.hsqldb.sqltool/org.hsqldb.cmdline.SqlTool --sql '\p helo' ||
Abort 'sqltool jar test failed'
java -p build/hsqldbmin.jar -m org.hsqldb/org.hsqldb.lib.tar.TarReaderMain ||
Abort 'hsqldbmin jar test failed'

# Test modular jar entries
java -p build/sqltool.jar:build/hsqldbmin.jar -m org.hsqldb.sqltool --sql "call 'helo';" mem ||
Abort 'admcsql jar entry test failed'

# Build Linux JRE
jlink  \
  -p "$JAVA_HOME/jmods:build/sqltool.jar:build/hsqldbmin.jar" \
  --compress 2 --strip-debug --no-header-files --no-man-pages  \
  --add-modules org.hsqldb,org.hsqldb.sqltool --output build/hfulljre.lin ||
Abort 'Linux JRE build failed'

build/hfulljre.lin/bin/java -m org.hsqldb.sqltool --sql "call 'helo';" mem
